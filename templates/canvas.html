<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}"
    xml:lang="{% firstof LANGUAGE_CODE 'en' %}"
    lang="{% firstof LANGUAGE_CODE 'en' %}">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="{{ MEDIA_URL }}js/swfobject.js"></script>
		<style type="text/css" media="screen">
		  .clear { /* generic container (i.e. div) for floating buttons */
              overflow: hidden;
              width: 100%;
          }
          a.button {
              background: transparent url('{{ MEDIA_URL }}img/bg_button_a.gif') no-repeat scroll top right;
              color: #444;
              display: block;
              float: left;
              font: normal 12px arial, sans-serif;
              height: 24px;
              margin-right: 6px;
              padding-right: 18px; /* sliding doors padding */
              text-decoration: none;
          }
          a.button span {
              background: transparent url('{{ MEDIA_URL }}img/bg_button_span.gif') no-repeat;
              display: block;
              line-height: 14px;
              padding: 5px 0 5px 18px;
          }
          a.button:active {
              background-position: bottom right;
              color: #000;
              outline: none; /* hide dotted outline in Firefox */
          }
          a.button:active span {
              background-position: bottom left;
              padding: 6px 0 4px 18px; /* push text down 1px */
          }
		</style>
		{% if pending_fb_authorization %}
        <script type="text/javascript">
            top.location = "https://graph.facebook.com/oauth/authorize?client_id=113435098718000&redirect_uri=http://apps.facebook.com/daizy_test/&type=user_agent&display=page&scope=read_stream";
        </script>
		{% endif %}
	</head>
	<body>
	    <div id="ytapiplayer">
            You need Flash player 8+ and JavaScript enabled to view this video.
        </div>

        <div>
            <a class='button' href="javascript:playlist.previous()"><span>Back</span></a>
            <a class='button' href="javascript:ytplayer.playVideo()"><span>Play</span></a>
            <a class='button' href="javascript:ytplayer.pauseVideo()"><span>Pause</span></a>
            <a class='button' href="javascript:playlist.next()"><span>Next</span></a>
        </div>
	</body>
	
	<script type="text/javascript">
        var atts = { id: "myytplayer" };
        var params = { allowScriptAccess: "always" };
        var youtubes = {{ youtubes|safe }};

        /* parses id from a full youtube url */
        function parseId (url) { return url.replace(/^[^v]+v.(.{11}).*/,"$1"); }

        /* gets called once the player is loaded and ready */
        function onYouTubePlayerReady (playerId) {
            ytplayer = document.getElementById(atts.id);
            ytplayer.addEventListener('onStateChange', 'onStateChangeListener');

            playlist = new function () {
                this.i = 0;
                this.posts = youtubes;
                this.fw = function () { if (this.i < this.posts.length - 1) { this.i++ } else { this.i = 0 } };
                this.rw = function () { if (this.i > 0 ) { this.i-- } else { this.i = this.posts.length - 1} };
                this.id = function () {
                    var post = this.posts[this.i];
                    // from_el.val(post.from.name);
                    // date_el.val(post.created_time);
                    return parseId(post);
                };
                this.next = function () { this.fw(); ytplayer.loadVideoById(this.id()) };
                this.previous = function () { this.rw(); ytplayer.loadVideoById(this.id()) }
            };
            ytplayer.cueVideoById(playlist.id());
        }

        function onStateChangeListener (newState) {
            switch(newState) {
                case 0:  // ended
                    playlist.fw();
                    ytplayer.loadVideoById(playlist.id());
                    break;
                case 5:  // cued
                    if (ytplayer && ytplayer.getDuration) {
                        duration_el.val(ytplayer.getDuration());
                    };
                    break;
            };
        }

        swfobject.embedSWF("http://www.youtube.com/apiplayer?&enablejsapi=1&playerapiid=ytapiplayer",
                            "ytapiplayer", "600", "400", "8", null, null, params, atts);
    </script>
</html>
